!function(){"use strict";function o(o,s,e,n,i,r,t){var a=this;this.$onInit=function(){this.creds={username:s.cookieUsername,password:null,domain:null,rememberLogin:angular.isDefined(s.cookieUsername)&&0<s.cookieUsername.length},/\blanguage=/.test(s.location.search)&&(this.creds.language=s.language),this.loginState=!1,this.verificationCodePattern="\\d{6}",this.passwords={newPassword:null,newPasswordConfirmation:null,oldPassword:null},this.showLogin=!1,e(function(){a.showLogin=!0},100)},this.login=function(){return a.loginState="authenticating",r.login(a.creds).then(function(o){o.totpmissingkey?(a.loginState="totpcode",t("totpcode")):o.totpdisabled?(a.loginState="totpdisabled",a.cn=o.cn,a.url=o.url):(a.loginState="logged",a.cn=o.cn,a.url=o.url,e(function(){a.continueLogin()},1e3))},function(o){var s,e;a.loginState="error",o.error?a.errorMessage=o.error:0<o.grace?(a.loginState="passwordwillexpire",a.cn=o.cn,a.url=o.url,a.errorMessage=l("You have %{0} logins remaining before your account is locked. Please change your password in the preference dialog.",o.grace)):0<o.expire?(e=86400<o.expire?(s=Math.round(o.expire/86400),l("days")):3600<o.expire?(s=Math.round(o.expire/3600),l("hours")):60<o.expire?(s=Math.round(o.expire/60),l("minutes")):(s=o.expire,l("seconds")),a.loginState="passwordwillexpire",a.cn=o.cn,a.url=o.url,a.errorMessage=l("Your password is going to expire in %{0} %{1}.",s,e)):o.passwordexpired&&(a.loginState="passwordexpired",a.url=o.url)}),!1},this.restoreLogin=function(){a.loginState=!1,delete a.creds.verificationCode},this.continueLogin=function(){s.location.href===a.url?s.location.reload(!0):s.location.href=a.url},this.showAbout=function(o){function s(o){this.closeDialog=function(){o.hide()}}i.show({targetEvent:o,templateUrl:"aboutBox.html",controller:s,controllerAs:"about"}),s.$inject=["$mdDialog"]},this.changeLanguage=function(o){s.location.href=ApplicationBaseURL+"login?language="+this.creds.language},this.canChangePassword=function(o){return this.passwords.newPasswordConfirmation&&this.passwords.newPasswordConfirmation.length&&this.passwords.newPassword!=this.passwords.newPasswordConfirmation?(o.newPasswordConfirmation.$setValidity("newPasswordMismatch",!1),!1):(o.newPasswordConfirmation.$setValidity("newPasswordMismatch",!0),!!(this.passwords.newPassword&&0<this.passwords.newPassword.length&&this.passwords.newPasswordConfirmation&&this.passwords.newPasswordConfirmation.length&&this.passwords.newPassword==this.passwords.newPasswordConfirmation&&this.passwords.oldPassword&&0<this.passwords.oldPassword.length))},this.changePassword=function(){r.changePassword(this.creds.username,this.creds.domain,this.passwords.newPassword,this.passwords.oldPassword).then(function(o){a.loginState="message",a.url=o.url,a.errorMessage=l("The password was changed successfully.")},function(o){a.loginState="error",a.errorMessage=o})}}angular.module("SOGo.MainUI",["SOGo.Common","SOGo.Authentication"]),o.$inject=["$scope","$window","$timeout","Dialog","$mdDialog","Authentication","sgFocus"],angular.module("SOGo.MainUI").controller("LoginController",o)}();
//# sourceMappingURL=Main.js.map