!function(){"use strict";function e(){var a,t,o,r=this;if(this.defaults={},this.settings={},a=e.$document[0].getElementById("UserDefaults")){try{o=angular.fromJson(a.textContent||a.innerHTML)}catch(a){e.$log.error("Can't parse user's defaults: "+a.message),o={}}o.SOGoMailLabelsColorsKeys=[],o.SOGoMailLabelsColorsValues=[],_.forEach(o.SOGoMailLabelsColors,function(e,a){o.SOGoMailLabelsColorsKeys.push(a),o.SOGoMailLabelsColorsValues.push(e)}),_.forEach(o.SOGoSieveFilters,function(e){_.forEach(e.actions,function(e){"addflag"==e.method&&"$"==e.argument.charAt(0)&&(e.argument="_"+e.argument)})}),o.SOGoRememberLastModule&&(o.SOGoLoginModule="Last"),o.SOGoMailAutoSave=parseInt(o.SOGoMailAutoSave)||0,o.SOGoMailComposeWindowEnabled=angular.isDefined(o.SOGoMailComposeWindow),o.SOGoMailComposeFontSizeEnabled=parseInt(o.SOGoMailComposeFontSize)>0,window.CKEDITOR&&o.SOGoMailComposeFontSizeEnabled&&(window.CKEDITOR.config.fontSize_defaultLabel=o.SOGoMailComposeFontSize,window.CKEDITOR.addCss(".cke_editable { font-size: "+o.SOGoMailComposeFontSize+"px; }")),o.Vacation?(o.Vacation.startDate?o.Vacation.startDate=new Date(1e3*parseInt(o.Vacation.startDate)):(o.Vacation.startDateEnabled=0,o.Vacation.startDate=new Date,o.Vacation.startDate=o.Vacation.startDate.beginOfDay(),o.Vacation.startDate.addDays(1)),o.Vacation.endDate?o.Vacation.endDate=new Date(1e3*parseInt(o.Vacation.endDate)):(o.Vacation.endDateEnabled=0,o.Vacation.endDate=new Date(o.Vacation.startDate.getTime()),o.Vacation.endDate.addDays(1)),o.Vacation.autoReplyEmailAddresses&&o.Vacation.autoReplyEmailAddresses.length?o.Vacation.autoReplyEmailAddresses=o.Vacation.autoReplyEmailAddresses.join(","):delete o.Vacation.autoReplyEmailAddresses):o.Vacation={},angular.isUndefined(o.Vacation.autoReplyEmailAddresses)&&angular.isDefined(window.defaultEmailAddresses)&&(o.Vacation.autoReplyEmailAddresses=window.defaultEmailAddresses),angular.isUndefined(o.Vacation.daysBetweenResponse)&&(o.Vacation.daysBetweenResponse=7),angular.isUndefined(o.Vacation.startDate)&&(o.Vacation.startDateEnabled=0,o.Vacation.startDate=new Date),angular.isUndefined(o.Vacation.endDate)&&(o.Vacation.endDateEnabled=0,o.Vacation.endDate=new Date),o.Forward&&o.Forward.forwardAddress&&(o.Forward.forwardAddress=o.Forward.forwardAddress.join(",")),angular.isUndefined(o.SOGoCalendarCategoriesColors)&&(o.SOGoCalendarCategoriesColors={},o.SOGoCalendarCategories=[]),angular.isUndefined(o.SOGoContactsCategories)?o.SOGoContactsCategories=[]:o.SOGoContactsCategories=_.compact(o.SOGoContactsCategories),angular.extend(r.defaults,o),r.$mdDateLocaleProvider=e.$mdDateLocaleProvider,angular.extend(r.$mdDateLocaleProvider,o.locale),angular.extend(r.$mdDateLocaleProvider,{firstDayOfWeek:o.SOGoFirstDayOfWeek,firstWeekOfYear:o.SOGoFirstWeekOfYear}),r.$mdDateLocaleProvider.firstDayOfWeek=parseInt(o.SOGoFirstDayOfWeek),r.$mdDateLocaleProvider.weekNumberFormatter=function(e){return l("Week %d",e)},r.$mdDateLocaleProvider.msgCalendar=l("Calender"),r.$mdDateLocaleProvider.msgOpenCalendar=l("Open Calendar"),r.$mdDateLocaleProvider.parseDate=function(e){return e?e.parseDate(r.$mdDateLocaleProvider,r.defaults.SOGoShortDateFormat):new Date(NaN)},r.$mdDateLocaleProvider.formatDate=function(e){return e?e.format(r.$mdDateLocaleProvider,e.$dateFormat||r.defaults.SOGoShortDateFormat):""},r.$mdDateLocaleProvider.parseTime=function(e){return e?e.parseDate(r.$mdDateLocaleProvider,r.defaults.SOGoTimeFormat):new Date(NaN)},r.$mdDateLocaleProvider.formatTime=function(e){return e?e.format(r.$mdDateLocaleProvider,r.defaults.SOGoTimeFormat):""}}if(t=e.$document[0].getElementById("UserSettings")){try{o=angular.fromJson(t.textContent||t.innerHTML)}catch(a){e.$log.error("Can't parse user's settings: "+a.message),o={}}o.Calendar&&(o.Calendar.PreventInvitationsWhitelist?o.Calendar.PreventInvitationsWhitelist=_.map(o.Calendar.PreventInvitationsWhitelist,function(a,t){var o=/^(.+)\s<(\S+)>$/.exec(a),n=new e.$User({uid:t,cn:o[1],c_email:o[2]});return n.$$image||(n.$$image=r.avatar(n.c_email,32,{no_404:!0})),n}):o.Calendar.PreventInvitationsWhitelist=[]),angular.extend(r.settings,o)}}e.$factory=["$document","$q","$timeout","$log","$mdDateLocale","sgSettings","Gravatar","Resource","User",function(a,t,o,r,n,s,i,d,l){return angular.extend(e,{$document:a,$q:t,$timeout:o,$log:r,$mdDateLocaleProvider:n,$gravatar:i,$$resource:new d(s.activeUser("folderURL"),s.activeUser()),$resourcesURL:s.resourcesURL(),$User:l}),new e}];try{angular.module("SOGo.PreferencesUI")}catch(e){angular.module("SOGo.PreferencesUI",["SOGo.Common"])}angular.module("SOGo.PreferencesUI").factory("Preferences",e.$factory),e.prototype.ready=function(){return e.$log.warn("Preferences.ready is deprecated -- access settings/defaults directly."),e.$q.when(!0)},e.prototype.avatar=function(a,t,o){var r,n=this,s=n.defaults.SOGoAlternateAvatar;return r=n.defaults.SOGoGravatarEnabled?e.$gravatar(a,t,s,o):[e.$resourcesURL,"img","ic_person_grey_24px.svg"].join("/"),o&&o.dstObject&&o.dstAttr&&(o.dstObject[o.dstAttr]=r),r},e.prototype.$save=function(){return e.$$resource.save("Preferences",this.$omit(!0)).then(function(e){return e})},e.prototype.$omit=function(e){var a,t;return a={},t={},angular.forEach(this,function(t,o){"constructor"!=o&&"$"!=o[0]&&(a[o]=e?angular.copy(t):t)}),a.defaults.SOGoMailLabelsColors={},_.forEach(a.defaults.SOGoMailLabelsColorsKeys,function(e,t){a.defaults.SOGoMailLabelsColors[e]=a.defaults.SOGoMailLabelsColorsValues[t]}),delete a.defaults.SOGoMailLabelsColorsKeys,delete a.defaults.SOGoMailLabelsColorsValues,_.forEach(a.defaults.SOGoSieveFilters,function(e){_.forEach(e.actions,function(e){"addflag"==e.method&&"_"==e.argument.charAt(0)&&"$"==e.argument.charAt(1)&&(e.argument=e.argument.substring(1))})}),a.defaults.SOGoMailComposeWindowEnabled||delete a.defaults.SOGoMailComposeWindow,delete a.defaults.SOGoMailComposeWindowEnabled,a.defaults.SOGoMailComposeFontSizeEnabled||(a.defaults.SOGoMailComposeFontSize=0),delete a.defaults.SOGoMailComposeFontSizeEnabled,a.defaults.Vacation&&(a.defaults.Vacation.startDateEnabled?a.defaults.Vacation.startDate=a.defaults.Vacation.startDate.getTime()/1e3:(delete a.defaults.Vacation.startDateEnabled,a.defaults.Vacation.startDate=0),a.defaults.Vacation.endDateEnabled?a.defaults.Vacation.endDate=a.defaults.Vacation.endDate.getTime()/1e3:(delete a.defaults.Vacation.endDateEnabled,a.defaults.Vacation.endDate=0),a.defaults.Vacation.autoReplyEmailAddresses?a.defaults.Vacation.autoReplyEmailAddresses=_.filter(a.defaults.Vacation.autoReplyEmailAddresses.split(","),function(e){return e.length}):a.defaults.Vacation.autoReplyEmailAddresses=[]),a.defaults.Forward&&a.defaults.Forward.forwardAddress&&(a.defaults.Forward.forwardAddress=a.defaults.Forward.forwardAddress.split(",")),a.settings.Calendar&&a.settings.Calendar.PreventInvitationsWhitelist&&(_.forEach(a.settings.Calendar.PreventInvitationsWhitelist,function(e){t[e.uid]=e.$shortFormat()}),a.settings.Calendar.PreventInvitationsWhitelist=t),a}}();
//# sourceMappingURL=Preferences.services.js.map