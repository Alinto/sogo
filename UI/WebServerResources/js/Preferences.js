!function(){"use strict";function a(a,c){a.state("preferences",{abstract:!0,views:{preferences:{templateUrl:"preferences.html",controller:"PreferencesController",controllerAs:"app"}},resolve:{statePreferences:b}}).state("preferences.general",{url:"/general",views:{module:{templateUrl:"generalPreferences.html"}}}).state("preferences.calendars",{url:"/calendars",views:{module:{templateUrl:"calendarsPreferences.html"}}}).state("preferences.addressbooks",{url:"/addressbooks",views:{module:{templateUrl:"addressbooksPreferences.html"}}}).state("preferences.mailer",{url:"/mailer",views:{module:{templateUrl:"mailerPreferences.html"}}}),c.otherwise("/general")}function b(a){return a}function c(a){a.$on("$routeChangeError",function(a,b,c,d){console.error(a,b,c,d)})}angular.module("SOGo.PreferencesUI",["ui.router","ck","SOGo.Common","SOGo.MailerUI","SOGo.ContactsUI","SOGo.Authentication","as.sortable"]).config(a).run(c),a.$inject=["$stateProvider","$urlRouterProvider"],b.$inject=["Preferences"],c.$inject=["$rootScope"]}(),function(){"use strict";function a(a,b,c,d,e){function f(){return!(d>0)&&!e}function g(){a.cancel()}function h(){a.hide()}var i=this;i.defaults=b,i.account=c,i.accountId=d,i.customFromIsReadonly=f,i.cancel=g,i.save=h}a.$inject=["$mdDialog","defaults","account","accountId","mailCustomFromEnabled"],angular.module("SOGo.PreferencesUI").controller("AccountDialogController",a)}(),function(){"use strict";function a(a,b,c,d,e,f){function g(){c.cancel()}function h(){return o.filter.rules&&o.filter.rules.length>0&&o.filter.actions&&o.filter.actions.length>0}function i(a){c.hide()}function j(a){o.filter.rules||(o.filter.rules=[]),o.filter.rules.push({field:"subject",operator:"contains"})}function k(a){o.filter.rules.splice(a,1)}function m(a){o.filter.actions||(o.filter.actions=[]),o.filter.actions.push({method:"discard"})}function n(a){o.filter.actions.splice(a,1)}var o=this,p=b.sieveCapabilities,q=b.forwardEnabled;b.vacationEnabled;o.filter=d,o.mailboxes=e,o.labels=f,o.cancel=g,o.hasRulesAndActions=h,o.save=i,o.addMailFilterRule=j,o.removeMailFilterRule=k,o.addMailFilterAction=m,o.removeMailFilterAction=n,o.fieldLabels={subject:l("Subject"),from:l("From"),to:l("To"),cc:l("Cc"),to_or_cc:l("To or Cc"),size:l("Size (Kb)"),header:l("Header")},p.indexOf("body")>-1&&(o.fieldLabels.body=l("Body")),o.methodLabels={discard:l("Discard the message"),keep:l("Keep the message"),stop:l("Stop processing filter rules")},q&&(o.methodLabels.redirect=l("Forward the message to")),p.indexOf("reject")>-1&&(o.methodLabels.reject=l("Send a reject message")),p.indexOf("fileinto")>-1&&(o.methodLabels.fileinto=l("File the message in")),(p.indexOf("imapflags")>-1||p.indexOf("imap4flags")>-1)&&(o.methodLabels.addflag=l("Flag the message with")),o.numberOperatorLabels={under:l("is under"),over:l("is over")},o.textOperatorLabels={is:l("is"),is_not:l("is not"),contains:l("contains"),contains_not:l("does not contain"),matches:l("matches"),matches_not:l("does not match")},p.indexOf("regex")>-1&&(o.textOperatorLabels.regex=l("matches regex"),o.textOperatorLabels.regex_not=l("does not match regex")),o.flagLabels={seen:l("Seen"),deleted:l("Deleted"),answered:l("Answered"),flagged:l("Flagged"),junk:l("Junk"),not_junk:l("Not Junk")}}a.$inject=["$scope","$window","$mdDialog","filter","mailboxes","labels"],angular.module("SOGo.PreferencesUI").controller("FiltersDialogController",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,m,n){function o(a,b){b.$valid&&(d("xs")&&e("left").close(),c.go("preferences."+a))}function p(a){i.confirm(l("Warning"),l("Save preferences and reload page now?"),{ok:l("Yes"),cancel:l("No")}).then(function(){F(a,{quick:!0}).then(function(){b.location.reload(!0)})})}function q(a){L.preferences.defaults.SOGoCalendarCategoriesColors["New category"]="#aaa",L.preferences.defaults.SOGoCalendarCategories.push("New category"),h("calendarCategory_"+(L.preferences.defaults.SOGoCalendarCategories.length-1)),a.$setDirty()}function r(a,b){var c=L.preferences.defaults.SOGoCalendarCategories[a];L.preferences.defaults.SOGoCalendarCategories.splice(a,1),delete L.preferences.defaults.SOGoCalendarCategoriesColors[c],b.$setDirty()}function s(a){L.preferences.defaults.SOGoContactsCategories.push(""),h("contactCategory_"+(L.preferences.defaults.SOGoContactsCategories.length-1)),a.$setDirty()}function t(a,b){L.preferences.defaults.SOGoContactsCategories.splice(a,1),b.$setDirty()}function u(a,b){var c;L.preferences.defaults.AuxiliaryMailAccounts.push({}),c=_.last(L.preferences.defaults.AuxiliaryMailAccounts),c.name=l("New account"),c.identities=[{fullName:"",email:""}],c.receipts={receiptAction:"ignore",receiptNonRecipientAction:"ignore",receiptOutsideDomainAction:"ignore",receiptAnyAction:"ignore"},f.show({controller:"AccountDialogController",controllerAs:"$AccountDialogController",templateUrl:"editAccount?account=new",targetEvent:a,locals:{defaults:L.preferences.defaults,account:c,accountId:L.preferences.defaults.AuxiliaryMailAccounts.length-1,mailCustomFromEnabled:window.mailCustomFromEnabled}}).then(function(){b.$setDirty()})}function v(a,b,c){var d=L.preferences.defaults.AuxiliaryMailAccounts[b];f.show({controller:"AccountDialogController",controllerAs:"$AccountDialogController",templateUrl:"editAccount?account="+b,targetEvent:a,locals:{defaults:L.preferences.defaults,account:d,accountId:b,mailCustomFromEnabled:window.mailCustomFromEnabled}}).then(function(){L.preferences.defaults.AuxiliaryMailAccounts[b]=d,c.$setDirty()})}function w(a,b){L.preferences.defaults.AuxiliaryMailAccounts.splice(a,1),b.$setDirty()}function x(a){var b="_$$"+guid();L.preferences.defaults.SOGoMailLabelsColors[b]=["New label","#aaa"],a.$setDirty()}function y(a,b){delete L.preferences.defaults.SOGoMailLabelsColors[a],b.$setDirty()}function z(a,b){var c={match:"all"};f.show({templateUrl:"editFilter?filter=new",controller:"FiltersDialogController",controllerAs:"filterEditor",targetEvent:a,locals:{filter:c,mailboxes:M,labels:L.preferences.defaults.SOGoMailLabelsColors}}).then(function(){L.preferences.defaults.SOGoSieveFilters||(L.preferences.defaults.SOGoSieveFilters=[]),L.preferences.defaults.SOGoSieveFilters.push(c),b.$setDirty()})}function A(a,b,c){var d=angular.copy(L.preferences.defaults.SOGoSieveFilters[b]);f.show({templateUrl:"editFilter?filter="+b,controller:"FiltersDialogController",controllerAs:"filterEditor",targetEvent:null,locals:{filter:d,mailboxes:M,labels:L.preferences.defaults.SOGoMailLabelsColors}}).then(function(){L.preferences.defaults.SOGoSieveFilters[b]=d,c.$setDirty()})}function B(a,b){L.preferences.defaults.SOGoSieveFilters.splice(a,1),b.$setDirty()}function C(a){var b=[];angular.isDefined(L.preferences.defaults.Vacation.autoReplyEmailAddresses)&&(b=L.preferences.defaults.Vacation.autoReplyEmailAddresses.split(",")),L.preferences.defaults.Vacation.autoReplyEmailAddresses=_.union(window.defaultEmailAddresses.split(","),b).join(","),a.$setDirty()}function D(a,b){return j.$filter(a,b).then(function(a){return _.forEach(a,function(a){a.$$image||(a.image?a.$$image=a.image:L.preferences.avatar(a.c_email,32,{no_404:!0}).then(function(b){a.$$image=b}))}),a})}function E(a,c){var d;if(c.$dirty){for(a.preventDefault(),a.stopPropagation(),d=a.target;"A"!=d.tagName;)d=d.parentNode;i.confirm(l("Unsaved Changes"),l("Do you want to save your changes made to the configuration?"),{ok:l("Save"),cancel:l("Don't Save")}).then(function(){F(c,{quick:!0}).then(function(){b.location=d.href})},function(){b.location=d.href})}}function F(c,d){var e,f,h,j,k,m;if(f=!0,k=[],b.forwardConstraints>0&&angular.isDefined(L.preferences.defaults.Forward)&&L.preferences.defaults.Forward.enabled&&angular.isDefined(L.preferences.defaults.Forward.forwardAddress))for(h=L.preferences.defaults.Forward.forwardAddress.split(","),j=b.defaultEmailAddresses.split(/, */),_.forEach(j,function(a){var b=a.split("@")[1];b&&k.push(b.toLowerCase())}),e=0;e<h.length&&f;e++)m=h[e].split("@")[1].toLowerCase(),k.indexOf(m)<0&&1==b.forwardConstraints?(i.alert(l("Error"),l("You are not allowed to forward your messages to an external email address.")),f=!1):k.indexOf(m)>=0&&2==b.forwardConstraints&&(i.alert(l("Error"),l("You are not allowed to forward your messages to an internal email address.")),f=!1);return f?L.preferences.$save().then(function(a){d&&d.quick||(g.show(g.simple().content(l("Preferences saved")).position("bottom right").hideDelay(2e3)),c.$setPristine())}):a.reject()}function G(){return!!(L.passwords.newPassword&&L.passwords.newPassword.length>0&&L.passwords.newPasswordConfirmation&&L.passwords.newPasswordConfirmation.length&&L.passwords.newPassword==L.passwords.newPasswordConfirmation)}function H(){n.changePassword(L.passwords.newPassword).then(function(){var a=f.alert({title:l("Password"),content:l("The password was changed successfully."),ok:l("OK")});f.show(a).finally(function(){a=void 0})},function(a){var b=f.alert({title:l("Password"),content:a,ok:l("OK")});f.show(b).finally(function(){b=void 0})})}function I(a){return _.filter(L.timeZonesList,function(b){return b.toUpperCase().indexOf(a.toUpperCase())>=0})}function J(){m.defaults&&m.defaults.Vacation&&m.defaults.Vacation.enabled?(L.vacationStartDateMin=void 0,m.defaults.Vacation.startDateEnabled?(L.vacationStartDateMin=O,L.vacationStartDate=m.defaults.Vacation.startDate):m.defaults.Vacation.endDateEnabled?L.vacationStartDate=O:L.vacationStartDate=void 0,m.defaults.Vacation.endDateEnabled?L.vacationEndDate=m.defaults.Vacation.endDate:L.vacationEndDate=void 0):(L.vacationStartDateMin=void 0,L.vacationStartDate=void 0,L.vacationEndDate=void 0)}var K,L=this,M=[],N=new Date,O=N.addDays(1);L.preferences=m,L.passwords={newPassword:null,newPasswordConfirmation:null},L.go=o,L.onLanguageChange=p,L.addCalendarCategory=q,L.removeCalendarCategory=r,L.addContactCategory=s,L.removeContactCategory=t,L.addMailAccount=u,L.editMailAccount=v,L.removeMailAccount=w,L.addMailLabel=x,L.removeMailLabel=y,L.addMailFilter=z,L.editMailFilter=A,L.removeMailFilter=B,L.addDefaultEmailAddresses=C,L.userFilter=D,L.confirmChanges=E,L.save=F,L.canChangePassword=G,L.changePassword=H,L.timeZonesList=window.timeZonesList,L.timeZonesListFilter=I,L.timeZonesSearchText="",L.sieveVariablesCapability=b.sieveCapabilities.indexOf("variables")>=0,L.updateVacationDates=J,K=new k({id:0}),K.$getMailboxes().then(function(){for(var a=K.$flattenMailboxes({all:!0}),b=-1,c=a.length;++b<c;)M.push(a[b])}),m.ready().then(function(){m.defaults.SOGoAlternateAvatar&&(j.$alternateAvatar=m.defaults.SOGoAlternateAvatar),J()})}a.$inject=["$q","$window","$state","$mdMedia","$mdSidenav","$mdDialog","$mdToast","sgFocus","Dialog","User","Account","statePreferences","Authentication"],angular.module("SOGo.PreferencesUI").controller("PreferencesController",a)}();
//# sourceMappingURL=Preferences.js.map